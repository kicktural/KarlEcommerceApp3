@model ProductFilterVM
<div id="wrapper">
    <!-- ****** Header Area Start ****** -->
  
    <!-- ****** Header Area End ****** -->
    <!-- ****** Quick View Modal Area Start ****** -->
    <div class="modal fade" id="quickview" tabindex="-1" role="dialog" aria-labelledby="quickview" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <button type="button" class="close btn" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

                <div class="modal-body">
                    <div class="quickview_body">
                        <div class="container">
                            <div class="row">
                                <div class="col-12 col-lg-5">
                                    <div class="quickview_pro_img">
                                        <img src="img/product-img/product-1.jpg" alt="">
                                    </div>
                                </div>
                                <div class="col-12 col-lg-7">
                                    <div class="quickview_pro_des">
                                        <h4 class="title">Boutique Silk Dress</h4>
                                        <div class="top_seller_product_rating mb-15">
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                        </div>
                                        <h5 class="price">$120.99 <span>$130</span></h5>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia expedita quibusdam aspernatur, sapiente consectetur accusantium perspiciatis praesentium eligendi, in fugiat?</p>
                                        <a href="#">View Full Product Details</a>
                                    </div>
                                    <!-- Add to Cart Form -->
                                    <form class="cart" method="post">
                                        <div class="quantity">
                                            <span class="qty-minus" onclick="var effect = document.getElementById('qty'); var qty = effect.value; if( !isNaN( qty ) &amp;&amp; qty &gt; 1 ) effect.value--;return false;"><i class="fa fa-minus" aria-hidden="true"></i></span>

                                            <input type="number" class="qty-text" id="qty" step="1" min="1" max="12" name="quantity" value="1">

                                            <span class="qty-plus" onclick="var effect = document.getElementById('qty'); var qty = effect.value; if( !isNaN( qty )) effect.value++;return false;"><i class="fa fa-plus" aria-hidden="true"></i></span>
                                        </div>
                                        <button type="submit" name="addtocart" value="5" class="cart-submit">Add to cart</button>
                                        <!-- Wishlist -->
                                        <div class="modal_pro_wishlist">
                                            <a href="wishlist.html" target="_blank"><i class="ti-heart"></i></a>
                                        </div>
                                        <!-- Compare -->
                                        <div class="modal_pro_compare">
                                            <a href="compare.html" target="_blank"><i class="ti-stats-up"></i></a>
                                        </div>
                                    </form>

                                    <div class="share_wf mt-30">
                                        <p>Share With Friend</p>
                                        <div class="_icon">
                                            <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                                            <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                                            <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                                            <a href="#"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ****** Quick View Modal Area End ****** -->

    <section class="shop_grid_area section_padding_100">
        <div class="container">
            <div class="row">
                <div class="col-12 col-md-4 col-lg-3">
                    <div class="shop_sidebar_area">

                        <div class="widget catagory mb-50">
                            <!--  Side Nav  -->
                            <div class="nav-side-menu">
                                <h6 class="mb-0">Catagories</h6>
                                <div class="menu-list">
                                    <ul id="menu-content2" class="menu-content collapse out">
                                        <!-- Single Item -->
                                       @*   <li data-toggle="collapse" data-target="#women2">
                                            <a href="#">@item.CategoryName</a>
                                               <ul class="sub-menu collapse show" id="women2">
                                            <li><a href="#">@item.CategoryName</a></li>
                                            <li><a href="#">Maxi Dresses</a></li>
                                            <li><a href="#">Prom Dresses</a></li>
                                            <li><a href="#">Little Black Dresses</a></li>
                                            <li><a href="#">Mini Dresses</a></li>
                                            </ul> 
                                        </li>  *@
                                        @foreach (var item in Model.CategoryFilters)
                                        {                                  
                                            <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                                                <input onclick="GetProductCategory()" value="@item.Id" type="checkbox" class="custom-control-input cats" id="color-1-@item.Id">
                                                <label class="custom-control-label" for="color-1-@item.Id">@item.CategoryName</label>
                                                <span class="badge border font-weight-normal">@item.Id</span>
                                            </div>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group ml-2">
                            <button type="button" class="btn btn-sm btn-light dropdown-toggle" data-toggle="dropdown">Showing</button>

                            <select onchange="GetProductCount()" id="countProduct">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>

                      @*   <div class="widget price mb-50">
                            <h6 class="widget-title mb-30">Filter by Price</h6>
                            <div class="widget-desc">
                                <div class="slider-range">
                                    <div data-min="0" data-max="3000" data-unit="$" class="slider-range-price ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" data-value-min="0" data-value-max="1350" data-label-result="Price:">
                                        <div class="ui-slider-range ui-widget-header ui-corner-all"></div>
                                        <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                                        <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                                    </div>
                                    <div class="range-price">Price: 0 - 1350</div>
                                </div>
                            </div>
                        </div> *@
@*                         <div class="sidebar__filter">
                            <div class="section-title">
                                <h4>Shop by price</h4>
                            </div>



                            <form id="priceFilterForm" class="w-75">
                                <div class="d-flex align-items-center">
                                    <input type="text" id="minPrice" class="form-control w-50 mr-1 mb-1" placeholder="Min" name="minPrice" />


                                    <input type="text" id="maxPrice" class="form-control w-50  mb-1" placeholder="Max" name="maxPrice" />

                                </div>
                                <input type="submit" class="btn btn-info w-100" value="Apply Filters" />




                            </form> *@

                        <div class="widget color mb-70">
                            <h6 class="widget-title mb-30">Filter by Color</h6>
                            <div class="widget-desc">
                                <ul class="d-flex justify-content-between">
                                    <li class="gray"><a href="#"><span>(3)</span></a></li>
                                    <li class="red"><a href="#"><span>(25)</span></a></li>
                                    <li class="yellow"><a href="#"><span>(112)</span></a></li>
                                    <li class="green"><a href="#"><span>(72)</span></a></li>
                                    <li class="teal"><a href="#"><span>(9)</span></a></li>
                                    <li class="cyan"><a href="#"><span>(29)</span></a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="widget size mb-50">
                            <h6 class="widget-title mb-30">Filter by Size</h6>
                            <div class="widget-desc">
                                <ul class="d-flex justify-content-between">
                                    <li><a href="#">XS</a></li>
                                    <li><a href="#">S</a></li>
                                    <li><a href="#">M</a></li>
                                    <li><a href="#">L</a></li>
                                    <li><a href="#">XL</a></li>
                                    <li><a href="#">XXL</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="widget recommended">
                            <h6 class="widget-title mb-30">Recommended</h6>

                            <div class="widget-desc">
                                @foreach (var item in Model.ProductDetailFeatureds.Take(3))
                                {
                                    
                                <!-- Single Recommended Product -->
                                <div class="single-recommended-product d-flex mb-30">
                                    <div class="single-recommended-thumb mr-3">
                                        <img src="@item.PhotoUrl" alt="@item.ProductName">
                                    </div>
                                    <div class="single-recommended-desc">
                                        <h6>@item.ProductName</h6>
                                        <p>$@item.Discount</p>
                                            <button type="submit" width="10px" onclick="AddToCart(@item.Id)" class="add-to-cart-btn">@_languageService.GetKey("ADD TO CART")</button>
                                    </div>
      
                                </div>
                                }
                               
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-8 col-lg-9">
                    <div class="shop_grid_product_area">
                        <div id="productList" class="row">
                         @*     @foreach (var item in Model.productFilters)
                            {
                                
                             <!-- Single gallery Item -->
                            <div class="col-12 col-sm-6 col-lg-4 single_gallery_item wow fadeInUpBig" data-wow-delay="0.2s">
                                <!-- Product Image -->
                                <div class="product-img">
                                    <img src="@item.PhotoUrl" alt="@item.Name">
                                    <div class="product-quicview">
                                        <a href="#" data-toggle="modal" data-target="#quickview"><i class="ti-plus"></i></a>
                                    </div>
                                </div>
                                <!-- Product Description -->
                                <div class="product-description d-flex align-items-center justify-content-center">
                                    <h4 class="product-price">@item.Discount</h4>
                                    <p>@item.Name</p>
                                    <!-- Add to Cart -->
                                    <a href="#" class="add-to-cart-btn">ADD TO CART</a>
                                </div>
                            </div> 
                            }   *@
                        </div>
                    </div>

                    <div class="col-12">
                        <nav>
                            <ul id="pagination" class="pagination justify-content-center">
                                @if (ViewBag.CurrentPage > 1)
                                {

                                    <li class="page-item"><a class="page-link" href="/product?page=@(ViewBag.CurrentPage - 1)">Previous</a></li>
                                }

                                 @for (int i = 0; i < ViewBag.ProductCount; i++)
                                {
                                    <li class="page-item @((i+1 == ViewBag.CurrentPage) ? "active" : "" )"><a class="page-link" href="/product?page=@(i+1)">@(i + 1)</a></li>
                                } 
                                @if (ViewBag.CurrentPage < ViewBag.ProductCount)
                                {

                                    <li class="page-item"><a class="page-link" href="/product?page=@(ViewBag.CurrentPage + 1)">Next</a></li>
                                }
                            </ul>
                        </nav>
                    </div>

                  @*   <div class="shop_pagination_area wow fadeInUp" data-wow-delay="1.1s">
                        <nav aria-label="Page navigation">
                            <ul class="pagination pagination-sm">
                                <li class="page-item active"><a class="page-link" href="#">01</a></li>
                                <li class="page-item"><a class="page-link" href="#">02</a></li>
                                <li class="page-item"><a class="page-link" href="#">03</a></li>
                            </ul>
                        </nav>
                    </div> *@

                </div>
            </div>
        </div>
    </section>


</div>


@section Scripts {
    <script>
        const countProduct = document.querySelector('#countProduct');
        const productList = document.querySelector('#productList');
        const pageLink = document.querySelectorAll('.page-link');
        const pageItem = document.querySelectorAll('.page-item');
        const pagination = document.querySelector('#pagination');

        const cats = document.querySelectorAll('.cats');




        for (let i = 0; i < pageLink.length; i++) {
            pageLink[i].addEventListener('click', function (e) {
                let dataList = JSON.parse(localStorage.getItem("data"));
                dataList.page = pageLink[i].innerText;
                localStorage.setItem("data", JSON.stringify(dataList));
                GetFilteredData();
            });
        }



        function GetProductCount() {
            var value = countProduct.options[countProduct.selectedIndex].value;
            let dataList = JSON.parse(localStorage.getItem("data"));
            dataList.take = value;
            localStorage.setItem("data", JSON.stringify(dataList));
            GetFilteredData();
        }

        $(function () {
            let cookieData = {
                take: 3,
                page: 1,
                categories: null
            };
            localStorage.setItem("data", JSON.stringify(cookieData));
            GetFilteredData(1, 3, );
        })


        function GetFilteredData() {
            let dataList = JSON.parse(localStorage.getItem("data"));

            $.ajax({
                type: 'GET',
                url: `/Product/GetDatas?page=${dataList.page}&take=${dataList.take}&categoryList=${dataList.categories}`,
                contentType: 'application/json',
                success: function (e) {
                    console.log(e)
                    ProductList(e.products, e.productCount, dataList.take);
                }
            })
        }

        function GetProductCategory() {
            let catList = "";
            for (let i = 0; i < cats.length; i++) {
                if (cats[i].checked) {
                    catList += cats[i].value + ",";
                }
            }
            let category = catList.substring(0, catList.length - 1);
            let dataList = JSON.parse(localStorage.getItem("data"));
            dataList.categories = category;
            localStorage.setItem("data", JSON.stringify(dataList));
            GetFilteredData();
        }

        function GetPage(data, page) {
            let dataList = JSON.parse(localStorage.getItem("data"));
            dataList.page = data;
            localStorage.setItem("data", JSON.stringify(dataList));
            GetFilteredData();
        }

        
        function AddToCart(id) {

            let cart = {
                id: id,
                quantity: 1
            }

            $.ajax({
                type: 'POST',
                url: `/Cart/AddToCart?id=${cart.id}&quantity=${cart.quantity}`,
                contentType: "application/json",
                data: cart,
                success: function (e) {
                    Swal.fire({
                        position: "center",
                        icon: "success",
                        title: "Successfully Added!",
                        showConfirmButton: false,
                        timer: 1500
                    });
                },
                error: function () {
                    Swal.fire({
                        position: "center",
                        icon: "error",
                        title: "Product not added",
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            })
        }


        function ProductList(datas, productCount, take) {
            productList.innerHTML = '';
            for (let i = 0; i < datas.length; i++) {
                productList.innerHTML += `
                                            <div class="col-lg-4 col-md-6 col-sm-6 pb-1">
                                                <div class="product-item bg-light mb-4">
                                                    <div class="product-img position-relative overflow-hidden">
                                                            <img class="img-fluid w-100" src="${datas[i].photoUrl}" alt="${datas[i].name}">
                                                            <div class="text-center py-4">
                                                                    <a class="h6 text-decoration-none text-truncate" href = "#" > ${datas[i].name}</a>
                                                                <div class="d-flex align-items-center justify-content-center mt-2">
                                                        $<h5>${datas[i].discount} </h5><h6 class="text-muted ml-2">$<del>${datas[i].price}</del > </h6>
                                                                </div>
                                                                         <div class="product-description d-flex align-items-center justify-content-center mb-5">                                        
                                                         </div>
                                                                           <button type="submit" onclick="AddToCart(${datas[i].id})" class="add-to-cart-btn">@_languageService.GetKey("ADD TO CART")</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    </div>
                                        `
            }

            pagination.innerHTML = '';
            for (let i = 0; i < productCount; i++) {
                pagination.innerHTML +=
                    `
                            <li class="page-item">
                                <a onclick="GetPage(${i + 1}, ${take})" class="page-link">
                                    ${i + 1}
                                </a>
                            </li>
                            `
            }
        }



    </script>
}